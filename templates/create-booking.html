<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Booking</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Create a New Booking</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <div id="availability-info" style="margin-top: 10px; color: blue;">Select a date to check availability</div>
        <button type="submit">Create Booking</button>
    </form>
    <a href="{% url 'view_bookings' %}">View My Bookings</a>

    <script>
        $(document).ready(function() {
            $('input[type="date"]').on('change', function() {
                const selectedDate = $(this).val();
                if (selectedDate) {
                    $.ajax({
                        url: "{% url 'check_availability' %}",
                        data: { date: selectedDate },
                        success: function(response) {
                            if (response.available_spaces !== undefined) {
                                $('#availability-info').text(
                                    `Available spaces for ${selectedDate}: ${response.available_spaces}`
                                );
                            } else {
                                $('#availability-info').text("Could not retrieve availability.");
                            }
                        },
                        error: function() {
                            $('#availability-info').text("Error checking availability.");
                        }
                    });
                } else {
                    $('#availability-info').text("Select a date to check availability.");
                }
            });
        });
    </script>
</body>
</html>
